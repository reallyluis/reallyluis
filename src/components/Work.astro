---
import './Work.scss';

const api = new URL(import.meta.env.CONTENT_API);
api.search = new URLSearchParams({ct: "works"}).toString();

const response = await fetch(api.toString());
const works = await response.json();
---

<section class="my-work" id="work" data-nosnippet>
  <div class="my-work__content">
    <h2 class="section__title section__title--work">My Work</h2>
    <p class="section__subtitle section__subtitle--work">A selection
      of my range of work</p>
    <div class="portfolio">
      <div class="portfolio__item"
          data-workid="Fundraising">
        <div class="portfolio__title">Fundraising</div>
        <img src="/img/crowd-fundraising.webp" loading="lazy" width="372" height="248"
            alt="" class="portfolio__img" />
      </div>
      <div class="portfolio__item"
          data-workid="Entertainment">
        <div class="portfolio__title">Entertainment</div>
        <img src="/img/concert.webp" loading="lazy" width="372" height="248"
            alt="" class="portfolio__img" />
      </div>
      <div class="portfolio__item"
        data-workid="Business">
        <div class="portfolio__title">Business</div>
        <img src="/img/business-coffee-shop.webp" loading="lazy" width="372"
          height="248" alt="" class="portfolio__img" />
      </div>
      <div class="portfolio__item"
          data-workid="Telecommunications">
        <div class="portfolio__title">Telecommunications</div>
        <img src="/img/telecom.webp" loading="lazy" width="372" height="248"
            alt="" class="portfolio__img" />
      </div>
      <div class="portfolio__item"
          data-workid="Government">
        <div class="portfolio__title">Government</div>
        <img src="/img/capital.webp" loading="lazy" width="372" height="248"
            alt="" class="portfolio__img" />
      </div>
      <div class="portfolio__item"
          data-workid="Web">
        <div class="portfolio__title">Web</div>
        <img src="/img/code-two-screens.webp" loading="lazy" width="372"
            height="248" alt="" class="portfolio__img" />
      </div>
    </div>
  </div>
</section>

<script define:vars={{works}}>
  const renderModal = () => {
    const body = document.querySelector('body');
    const modalToggleLinks = document.querySelectorAll('.portfolio__item');
    const modalContainer = document.querySelector('.page-modal');

    // hide if browser does not support dialog/showModal
    if (typeof modalContainer.showModal !== 'function') {
      modalContainer.hidden = true;
    }

    if (modalToggleLinks) {
      modalToggleLinks.forEach((link) => {
        link.addEventListener('click', (el) => {
          el.stopPropagation();
          const title = el.target.parentElement.dataset.workid;
          const description = works[title] ?
            works[title] :
            {
              title: 'Oopss!',
              description: 'Something went wrong.  Please try again.',
            };
          const html = `
            <div data-id="${title}">
              <h3>${title}</h3>
              <div unselectable="on">${description}</div>
            </div>
          `;

          modalContainer.innerHTML += html;
          if (typeof modalContainer.showModal === "function") {
            modalContainer.showModal();
            body.classList.add('disable-scroll');
          }
        });
      });
    }

    if (modalContainer) {
      modalContainer.addEventListener('click', () => {
        body.classList.remove('disable-scroll');
        modalContainer.close();
        modalContainer.innerHTML = '';
      });
    }
  };

  renderModal();
</script>
