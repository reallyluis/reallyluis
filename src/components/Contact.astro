---
const contactAPI = import.meta.env.CONTACT_API;
---

<section class="contact-me" id="contact" data-nosnippet>
  <h2 class="section__title section__title--contact">Contact Me</h2>
  <p class="section__subtitle section__subtitle--contact">get in touch</p>
  <div class="contact-me__body">
    <form id="contact" class="contact-me__form">
      <input type="text" id="fname" name="fname" value="" placeholder="name" required />
      <label for="fname">
        Name
      </label>

      <input type="email" id="email" name="email" value="" placeholder="email" required />
      <label for="email">
        Email
      </label>

      <textarea id="comment" name="comment" cols="30" rows="5" placeholder="comment" required></textarea>
      <label for="comment">
        Comment
      </label>

      <button id="contact-submit" class="btn" type="submit">Send</button>
    </form>
    <div class="contact-me__success hide" data-nosnippet>
      <p><b>Thanks!</b>  Your message was sent successfully.</p>
    </div>
  </div>
  <img src="/img/contact.webp" loading="lazy" width="200" height="366"
      alt="Photo of smartphone on desk." class="contact-me__img" />
</section>

<style>
  .contact-me {
    max-width: 1000px;
    margin: 0 auto;
  }

  .contact-me__form {
    display: flex;
    flex-direction: column;
    padding: 5px;
  }

  .contact-me__form.hide {
    display: none;
  }

  .contact-me__form ::-webkit-input-placeholder { opacity: 0; }

  .contact-me__form ::-moz-placeholder { opacity: 0; }

  .contact-me__form :-ms-input-placeholder { opacity: 0; }

  .contact-me__form ::placeholder { opacity: 0; }

  .contact-me__form label,
  .contact-me__form input,
  .contact-me__form textarea {
    transition: all 0.2s;
    touch-action: manipulation;
  }

  .contact-me__form label,
  .contact-me__form button {
    font-weight: var(--fw-bold);
  }

  .contact-me__form label {
    line-height: 1;
    padding: 0 0.25em;
    background-color: var(--clr-light);
  }

  .contact-me__form input,
  .contact-me__form textarea {
    margin: 1em 0 0.25em;
    cursor: text;
    border: 0;
    outline: 1px solid var(--fc-dark);
    outline-offset: 4px;
    color: var(--fc-dark);
    background-color: transparent;
  }

  .contact-me__form textarea {
    resize: none;
  }

  .contact-me__form input + label,
  .contact-me__form textarea + label {
    width: max-content;
    color: var(--fc-dark);
    cursor: text;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transform-origin: left top;
    transform: translate(0, -1.5em);
  }

  .contact-me__form textarea + label {
    transform: translate(0, -6.1em);
  }

  .contact-me__form input:focus + label,
  .contact-me__form input:not(:placeholder-shown) + label {
    transform: translate(0, -2.5em) scale(0.9);
  }

  .contact-me__form textarea:focus + label,
  .contact-me__form textarea:not(:placeholder-shown) + label {
    transform: translate(0, -7.1em) scale(0.9);
  }

  .contact-me__form button {
    color: var(--fc-dark);
    background-color: var(--clr-accent);
    font-size: 1.5rem;
    padding: 0.5em;
    border: 0;
    margin: 0 0 1.5em;
    text-transform: uppercase;
    cursor: pointer;
  }

  .contact-me__form button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .contact-me__success {
    margin: 6.5em 0;
  }

  .contact-me__success b {
    padding-right: 0.25em;
  }

  .contact-me__img {
    box-shadow: var(--bs);
  }

  @media (min-width: 600px) {
    .contact-me {
      display: grid;
      grid-template-columns: 1fr 200px;
      grid-template-areas:
        "title img"
        "subtitle img"
        "text img";
      grid-column-gap: 2em;
    }

    .section__title--contact {
      grid-area: title;
    }

    .section__subtitle--contact {
      grid-column: 1 / -1;
      grid-row: 2;
      position: relative;
      left: -1em;
      width: calc(100% + 2em);
      padding-left: 1em;
      padding-right: calc(200px + 4em);
    }

    .contact-me__img {
      grid-area: img;
      position: relative;
      z-index: 2;
    }
  }

  @media only screen and (min-device-width: 375px) and (max-device-height: 812px) and (-webkit-device-pixel-ratio: 2) {
    .contact-me__form input + label {
      transform: translate(0, -1.65em);
    }

    .contact-me__form input:focus + label,
    .contact-me__form input:not(:placeholder-shown) + label {
      transform: translate(0, -2.65em) scale(0.9);
    }
  }
</style>

<script define:vars={{contactAPI}}>
  /**
   * Send contact form
   * @param {object} data
   */
  const sendContact = async (data) => {
    const response = await fetch(contactAPI, {
      method: "POST",
      mode: "cors",
      headers: {
        "Content-Type": "application/json; charset=UTF-8",
      },
      body: JSON.stringify(data),
    });

    return await response.json();
  };

  /**
   * Resets contact form
   * @param {object} contactForm The form dom
   * @param {object} contactSubmitBtn The form submit button
   */
  const resetForm = (contactForm, contactSubmitBtn) => {
    // Reset form fields
    contactForm.fname.value = "";
    contactForm.email.value = "";
    contactForm.comment.value = "";
    contactSubmitBtn.disabled = false;
  };

  const contactForm = document.querySelector("form");
  const contactSuccess = document.querySelector(".contact-me__success");
  const contactSubmitBtn = document.getElementById("contact-submit");
  if (contactForm) {
    contactForm.addEventListener("submit", (e) => {
      e.preventDefault();
      contactSubmitBtn.disabled = true;
      const contact = {
        name: contactForm.fname.value,
        email: contactForm.email.value,
        comment: contactForm.comment.value,
      };

      if (sendContact) {
        sendContact(contact);

        contactForm.classList.add("hide");
        contactSuccess.classList.remove("hide");
        resetForm(contactForm, contactSubmitBtn);

        setTimeout(() => {
          contactForm.classList.remove("hide");
          contactSuccess.classList.add("hide");
        }, 2000);
      } else {
        resetForm(contactForm, contactSubmitBtn);
      }
    });
  }
</script>